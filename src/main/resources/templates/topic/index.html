<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/layout}">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Quản lý chủ đề </title>
<meta name="description" content="Ela Admin - HTML5 Admin Template">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="apple-touch-icon" href="https://i.imgur.com/QRAUqs9.png">
<link rel="shortcut icon" href="https://i.imgur.com/QRAUqs9.png">
</head>

<body>
	<!-- Content -->
	<div class="content" layout:fragment="layout-content">
		<!-- Animated -->
		<div class="animated fadeIn">
			<!-- To Do and Live Chat -->
			<div class="row">
				<div class="col-lg-12">
					<div class="card">
						<div class="card-header row">
							<div class=" col-lg-6 text-left">
								<strong class="card-title">Danh sách chủ đề</strong>
							</div>
							<div class=" col-lg-6 text-right">
								<button class="btn btn-primary btn-sm" data-toggle="modal"
									data-target="#insertModal" type="button">Thêm mới</button>
							</div>
						</div>
						<div class="table-stats order-table ov-h">
							<table class="table ">
								<thead>
									<tr>
										<th class="serial">#</th>
										<th>Tên</th>
										<th>Loại chủ đề</th>
										<th>Phòng ban</th>
										<th>Thao tác</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="topic : ${lstTopic}">
										<td class="serial" th:text="${topic.idTopic}"></td>
										<td><span class="name" th:text="${topic.nameTopic}"></span>
										</td>
										<td><span class="product"
											th:text="${topic.typeTopic.nameTypeTopic}"></span></td>
										<td><span th:text="${topic.department.nameDepartment}"></span></td>
										<td><input class="btn btn-info btn-sm"
											th:onclick="'editTopic (\'' + ${topic.idTopic}+ '\');'"
											data-toggle="modal" data-target="#editModal" type="button"
											value="Sửa"> <input class="btn btn-danger btn-sm"
											th:onclick="'deleteTopic (\'' + ${topic.idTopic}+ '\');'"
											type="button" value="Xóa"></td>
									</tr>
								</tbody>
							</table>
						</div>
						<!-- /.table-stats -->
					</div>
				</div>
				<div class="col-lg-6">
					<div class="card">
						<div class="card-header">
							<strong class="card-title">Danh sách loại chủ đề</strong>
						</div>
						<div class="table-stats order-table ov-h">
							<table class="table ">
								<thead>
									<tr>
										<th>ID</th>
										<th>Tên</th>
										<th>Thao tác</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="typeTopic : ${lstTypeTopic}">
										<td class="serial" th:text="${typeTopic.idTypeTopic}"></td>
										<td><span class="name"
											th:text="${typeTopic.nameTypeTopic}"></span></td>
										<td><input class="btn btn-info btn-sm"
											th:onclick="'editTypeTopic (\'' + ${typeTopic.idTypeTopic}+ '\');'"
											type="button" value="Sửa"> <input
											class="btn btn-danger btn-sm"
											th:onclick="'deleteTypeTopic (\'' + ${typeTopic.idTypeTopic}+ '\');'"
											type="button" value="Xóa"></td>
									</tr>
								</tbody>
							</table>
						</div>
						<!-- /.table-stats -->
					</div>
				</div>
				<div class="col-lg-6">
					<div class="card">
						<div class="card-header">Loại chủ đề</div>
						<div class="card-body card-block">
							<form action="/topic/addTypeTopic" method="post" class="">
								<div class="form-group">
									<div class="input-group">
										<input type="hidden" id="idTypeTopic" name="idTypeTopic"
											value="-1" class="form-control">
									</div>
								</div>
								<div class="form-group">
									<div class="input-group">
										<input type="text" id="nameTypeTopic" name="nameTypeTopic"
											placeholder="Tên loại chủ đề" class="form-control">
									</div>
								</div>
								<div class="form-actions form-group">
									<button type="button" onclick="saveTypeTopic()"
										class="btn btn-primary btn-sm">Lưu</button>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
			<div class="modal fade" id="insertModal" tabindex="-1" role="dialog"
				aria-labelledby="insertModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="insertModalLabel">Thêm chủ đề</h5>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<form th:action="@{/topic/insert}" th:object="${topicRequest}"
							method="post">
							<div class="modal-body">
								<div class="form-group">
									<input type="text" class="form-control" id="nameTopic"
										placeholder="Tên chủ đề" name="nameTopic" value="" required>
								</div>
								<div class="form-group">
									<select id="selectDeparment" name="idDeparment"
										class="form-control" required>
										<option value="">Chọn phòng ban</option>
										<option th:each="department: ${lstDepartment}"
											th:value="${department.idDepartment}"
											th:text="${department.nameDepartment}"></option>
									</select>
								</div>
								<div class="form-group">
									<select id="selectTypeTopic" name="idTypeTopic"
										class="form-control" required>
										<option value="">Chọn loại chủ đề</option>
										<option th:each="typeTopic: ${lstTypeTopic}"
											th:value="${typeTopic.idTypeTopic}"
											th:text="${typeTopic.nameTypeTopic}"></option>
									</select>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-dismiss="modal">Hủy</button>
								<button type="submit" class="btn btn-primary">Lưu</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal fade" id="editModal" tabindex="-1" role="dialog"
				aria-labelledby="editModalLabel" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="editModalLabel">Chỉnh sửa chủ
								đề</h5>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<form th:action="@{/topic/insert}" th:object="${topicRequest}"
							method="post">
							<div class="modal-body">
								<div class="form-group">
									<input type="text" class="form-control" id="idEditTopic"
										placeholder="Tên chủ đề" name="idTopic" value=""
										hidden="hidden" required> <input type="text"
										class="form-control" id="nameEditTopic"
										placeholder="Tên chủ đề" name="nameTopic" value="" required>
								</div>
								<div class="form-group">
									<select id="selectEditDeparment" name="idDeparment"
										class="form-control" required>
										<option value="NONE">Chọn phòng ban</option>
										<option th:each="department: ${lstDepartment}"
											th:value="${department.idDepartment}"
											th:text="${department.nameDepartment}"></option>
									</select>
								</div>
								<div class="form-group">
									<select id="selectEditTypeTopic" name="idTypeTopic"
										class="form-control" required>
										<option value="NONE">Chọn loại chủ đề</option>
										<option th:each="typeTopic: ${lstTypeTopic}"
											th:value="${typeTopic.idTypeTopic}"
											th:text="${typeTopic.nameTypeTopic}"></option>
									</select>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary"
									data-dismiss="modal">Hủy</button>
								<button type="submit" class="btn btn-primary">Lưu</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!-- .animated -->
		<script type="text/javascript">
			$(document).ready(function() {
				$("li.active").removeClass("active");
				$("#topic").addClass("active");
			})
			function saveTypeTopic() {
				var idTypeTopic = $("#idTypeTopic").val();
				var nameTypeTopic = $("#nameTypeTopic").val();
				var typeTopic = {
					idTypeTopic : idTypeTopic,
					nameTypeTopic : nameTypeTopic
				};
				console.log(typeTopic);
				$.post('/topic/addTypeTopic', typeTopic).done(
						function(response) {
							location.reload();
						});
			}

			function editTypeTopic(idTypeTopic) {
				$("#idTypeTopic").val(idTypeTopic);

				$.get('/topic/getTypeTopic/' + idTypeTopic)
						.done(
								function(response) {
									if (response.idTypeTopic == idTypeTopic) {
										$("#idTypeTopic").val(
												response.idTypeTopic);
										$("#nameTypeTopic").val(
												response.nameTypeTopic);
									}

								});
			}

			function deleteTypeTopic(idTypeTopic) {
				$.post('/topic/deleteTypeTopic', {
					idTypeTopic : idTypeTopic
				}).done(function(response) {
					location.reload();
				});
			}

			function deleteTopic(idTopic) {
				$.post('/topic/deleteTopic', {
					idTopic : idTopic
				}).done(function(response) {
					location.reload();
				});
			}

			
			
			function editTopic(idTopic) {
				$("#idEditTopic").val(idTopic);

				$
						.get('/topic/getTopic/' + idTopic)
						.done(
								function(response) {
									if (response.idTopic == idTopic) {
										console.log(response);
										$("#nameEditTopic").val(
												response.nameTopic);
										$(
												"#selectEditDeparment option[value="
														+ response.department.idDepartment
														+ "]").attr('selected',
												'selected');
										$(
												"#selectEditTypeTopic option[value="
														+ response.typeTopic.idTypeTopic
														+ "]").attr('selected',
												'selected');
									}

								});
			}

			function saveTopic() {
				var idTopic = $("#idTopic").val();
				var nameTopic = $("#nameTopic").val();
				var typeTopic = {
					idTypeTopic : idTypeTopic,
					nameTypeTopic : nameTypeTopic
				};
				console.log(typeTopic);
				$.post('/topic/addTypeTopic', typeTopic).done(
						function(response) {
							location.reload();
						});
			}
		</script>
	</div>
	<!-- /.content -->
</body>
</html>
